#!/usr/bin/env sh

set -e

usage() {
cat << EOF
\`r\`ecord: simple plain-text notes manager

Usage:
  $ r [<message>|edit]

records the respective message or opens the current log file for editing - if
no arguments are supplied, the last few entires will be displayed

Options:
  -h
    display this help message
  -n
    suppress timestamp

log files are rotated on a weekly basis
EOF
}

if [ "$1" = "-h" ]; then
	usage
	exit 1
fi

txt="$@"
edit=${EDITOR:-vi}

directory="$HOME/notes/log"
name=`date +"%G-%V"`

filepath="$directory/$name.txt"

if [ "$txt" = "" ]; then
	tail -n5 "$filepath"
elif [ "$txt" = "edit" ]; then
	$edit "$filepath"
else
	if [ "$1" = "-n" ]; then
		shift
		txt="$@"
	else
		txt="`date +"%F %T"` $txt"
	fi
	echo "$txt" | tee -a "$filepath"
fi
